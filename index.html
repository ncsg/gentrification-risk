<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
       "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>CCI Regional Early Warning System for Displacement</title>

<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

<style>
html, body {
	width: 100%;
	height: 100%;
	padding: 0;
	margin: 0;
	font-family: 'Open Sans', sans-serif;
}
#topBanner {
	background-color: #fff;
	padding: 10px;
	padding-left: 50px;
	font-family: 'Open Sans', sans-serif;
	font-size: 22px;
	font-weight: 600;
}
#mapContainer {
	border-top: 1px solid #ccc;
	border-bottom: 1px solid #ccc;
	margin-left: 0;
	margin-right: 0;
	width: 100%;
	height: 450px;
	padding: 0;
}
#map {
	width: 100%;
	height: 100%;
	padding: 0;
	margin: 0;
}
/* overrides default style for legends */
#map .cartodb-legend-stack .cartodb-legend .legend-title {
	font-family: 'Open Sans', sans-serif;
	color: black;
	font-size: 12px;
	font-weight: bold;
	text-transform: none;
}
#map .cartodb-legend-stack .cartodb-legend li {
	font-family: 'Open Sans', sans-serif;
	color: black;
	font-size: 12px;
	font-weight: normal;
	text-transform: none;
}
#map .cartodb-legend-stack .cartodb-legend li .bullet {
	height: 10px;
	width: 10px;
}
/* overrides default style for tooltips */
#map .cartodb-tooltip-content {
	padding: 6px;
}
#map .cartodb-tooltip-content p {
	font-family: 'Open Sans', sans-serif;
	font-size: 11px;
}
#map .cartodb-searchbox .text {
	font-family: 'Open Sans', sans-serif;
	font-size: 12px;
}
/* add scrolling to bootstrap menus */
.scrollable-menu {
    height: auto;
    max-height: 350px;
    overflow-x: hidden;
}
#layerSelectionContainer {
	position: absolute;
	top: 100px;
	left: 90px;
	padding: 0px;
	font-size: 12px;
}
#geoSelectionContainer {
	position: absolute;
	top: 140px;
	left: 90px;
	padding: 0px;
	font-size: 12px;
}
#textContent {
	width: 80%;
	padding-top: 30px; 
	margin-left: auto;
	margin-right: auto;
	font-family: 'Open Sans', sans-serif;
	font-size: 16px;
}
.figure {
	float: right;
	margin: 20px;
	margin-top: 0px;
	margin-right: -50px;
	padding: 0px;
	width: 400px;
	border: 1px solid #ccc;
	border-right: 0px;
}
.notes {
	font-size: 14px;
}
</style>

<!-- load code libraries -->
<script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js"></script>
<link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />
<script src="lib/jquery.min.js"></script>
<link rel="stylesheet" href="lib/bootstrap.css">
<script src="lib/bootstrap.js"></script>
<link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Open+Sans:400,600,700'>

</head>

<body>
	
<div id="topBanner">
	<a href='http://communityinnovation.berkeley.edu/'><img src='cci-logo.png' height='60'></a> &nbsp;&nbsp;&nbsp; CCI Regional Early Warning System for Displacement</div>
	
<div id="mapContainer"></div>

<div id ="layerSelectionContainer">
<div class="dropdown">
<!-- this button style is from the Bootstrap library -->
  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    Choose another data series...
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu scrollable-menu" id="layer-selector" aria-labelledby="dropdownMenu1">
	  
    <li><a href="#" onclick="swapMap('https://cci-displacement.cartodb.com/api/v2/viz/e78166c2-3222-11e5-a648-0e0c41326911/viz.json'); return false;">CCI displacement typologies</a></li>
    
    <li><a href="#" onclick="swapMap('https://cci-displacement.cartodb.com/api/v2/viz/3949b4a2-31a4-11e5-aeae-0e9d821ea90d/viz.json'); return false;">rsk_pop [title to come]</a></li>
    
    <li><a href="#" onclick="swapMap('https://cci-displacement.cartodb.com/api/v2/viz/2b46eec6-31c5-11e5-b5ff-0e0c41326911/viz.json'); return false;">rsk_prewar [title to come]</a></li>

    <li><a href="#" onclick="swapMap('https://cci-displacement.cartodb.com/api/v2/viz/5fa529e4-31c5-11e5-ba97-0e4fddd5de28/viz.json'); return false;">rsk_burden [title to come]</a></li>

    <li><a href="#" onclick="swapMap('https://cci-displacement.cartodb.com/api/v2/viz/1f194bfc-31c6-11e5-904c-0e4fddd5de28/viz.json'); return false;">rsk_employ [title to come]</a></li>

    <li><a href="#" onclick="swapMap('https://cci-displacement.cartodb.com/api/v2/viz/6cd76982-31c6-11e5-9b93-0e853d047bba/viz.json'); return false;">rsk_price [title to come]</a></li>

    <li><a href="#" onclick="swapMap('https://cci-displacement.cartodb.com/api/v2/viz/d966d7ea-31c6-11e5-a76b-0e0c41326911/viz.json'); return false;">rsk_rent [title to come]</a></li>

    <li><a href="#" onclick="swapMap('https://cci-displacement.cartodb.com/api/v2/viz/1d9cf94e-31c7-11e5-9940-0e0c41326911/viz.json'); return false;">rsk_units [title to come]</a></li>

    <li><a href="#" onclick="swapMap('https://cci-displacement.cartodb.com/api/v2/viz/415bc130-31c7-11e5-9a19-0e018d66dc29/viz.json'); return false;">rsk_colge [title to come]</a></li>
    
    <li><a href="#" onclick="swapMap('https://cci-displacement.cartodb.com/api/v2/viz/7b22760c-31c7-11e5-8946-0e4fddd5de28/viz.json'); return false;">dsp_lowinc [title to come]</a></li>
    
    <li><a href="#" onclick="swapMap('https://cci-displacement.cartodb.com/api/v2/viz/b35ae3ba-31c7-11e5-86fe-0e9d821ea90d/viz.json'); return false;">dsp_migrat [title to come]</a></li>
    
    <li><a href="#" onclick="swapMap('https://cci-displacement.cartodb.com/api/v2/viz/dff21f10-31c7-11e5-93e1-0e4fddd5de28/viz.json'); return false;">dsp_growth [title to come]</a></li>
    
    <li><a href="#">More to come...</a></li>
  </ul>
</div>
</div>

<div id ="geoSelectionContainer">
<div class="dropdown">
<!-- this button style is from the Bootstrap library -->
  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    Limit by county...
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu scrollable-menu" id="county-selector" aria-labelledby="dropdownMenu2">
    <li><a href="#">SHOW ALL</a></li>   
    <li><a href="#">Alameda</a></li>
    <li><a href="#">Contra Costa</a></li>
    <li><a href="#">Marin</a></li>
    <li><a href="#">Napa</a></li>
    <li><a href="#">San Francisco</a></li>
    <li><a href="#">San Mateo</a></li>
    <li><a href="#">Santa Clara</a></li>
    <li><a href="#">Solano</a></li>
    <li><a href="#">Sonoma</a></li>
  </ul>
</div>
</div>

<div id="textContent">
	
<div><br><a href="http://communityinnovation.berkeley.edu/uploads/Table.png" target="_blank"><img class="figure" src="http://communityinnovation.berkeley.edu/uploads/Table.png"></a>
The <a href="http://communityinnovation.berkeley.edu">Center for Community Innovation</a> (CCI) at UC Berkeley conducted regional data analysis to better understand the nature and drivers of gentrification and displacement, which was validated through 9 neighborhood case studies. From this analysis, and with careful review and input from an advisory committee, CCI developed 8 neighborhood typologies to help communities better characterize their experience and risks in an effort to raise awareness and stimulate action.
</div>

<div><br>Data and Documentation:</div>
<div><ul><li><a href="http://iurd.berkeley.edu/uploads/CCI_Final_Report.pdf">Methodology and results of the Regional Early Warning System [PDF]</a></li>
<li>Data downloads to come</li></ul>
</div>

<div>Additional Resources from CCI:</div>
<div><ul>
<li><a href="http://iurd.berkeley.edu/new-methodology-for-analyzing-displacement">Developing a New Methodology for Analyzing Potential Displacement</a></li>
<li><a href="http://iurd.berkeley.edu/uploads/Displacement_Lit_Review_Final.pdf">Literature review on gentrification, displacement and the relationship to public and private investment [PDF]</a></li>
<li><a href="http://communityinnovation.berkeley.edu/case-studies-on-gentrification-and-displacement-pressures-in-the-bay-area">Case studies on gentrification and displacement pressures in 9 neighborhoods in the Bay Area</a></li>
</ul>
</div>

<div class="notes"><br>Notes:
<br>Additional information about data sources in the map layers to come
</div>

<div><br><br></div>

<script>

// set the initial map options and url here
var INITIAL_MAP_SETTINGS = {
	center_lat: 37.8,
	center_lon: -122.3,
	zoom: 11
}
var INITIAL_VISJSON_URL = 'https://cci-displacement.cartodb.com/api/v2/viz/e78166c2-3222-11e5-a648-0e0c41326911/viz.json';
var currentVis;
var sublayer;
var baseQuery;

function setUpMap(visjsonURL, mapSettings) {
	$("#mapContainer").append("<div id='map'></div>");
	cartodb.createVis('map', visjsonURL, mapSettings)
		.done(function(vis, layers) {
			currentVis = vis;
			sublayer = layers[1].getSubLayer(0);
			baseQuery = sublayer.getSQL();
			
			// set custom text for search box
			$("#map .cartodb-searchbox .text").val("Go to place");
			// remove when user clicks on it
			$("#map .cartodb-searchbox .text").click(function() {
				$("#map .cartodb-searchbox .text").val("");
			});
			
			//sublayer.setSQL(sublayer.getSQL() + " WHERE _county = 'Alameda'");
		});
}

function swapMap(visjsonURL) {
	var currentMapSettings = {
		center_lat: currentVis.getNativeMap().getCenter().lat,
		center_lon: currentVis.getNativeMap().getCenter().lng,
		zoom: currentVis.getNativeMap().getZoom()
	}
	currentVis.remove();
	setUpMap(visjsonURL, currentMapSettings);
}

$('#county-selector li').click(function(e) {
	var selection = $(e.target).text();
	var query = baseQuery + " WHERE _county = '" + selection + "'";
	if (selection == 'SHOW ALL') {
		query = baseQuery;
	}
	sublayer.setSQL(query);
});

window.onload = function() {
	setUpMap(INITIAL_VISJSON_URL, INITIAL_MAP_SETTINGS);
}

</script>

</body>
</html>
